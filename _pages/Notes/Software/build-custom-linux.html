<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-67949307-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <!-- <title>Build Custom Linux &mdash; RDU-Wiki 1.0 documentation</title> -->
    <title>Build Custom Linux</title>
    
    <link rel="stylesheet" href="../../../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Dancing+Script:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Courgette' rel='stylesheet' type='text/css'>
    
    <div class="rduhome"  role="contentinfo">
		 <a href="http://rdu.im" style="font-family: 'Courgette', serif;" >Return to Ruixiang's Home Page</a>
	</div>
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="top" title="RDU-Wiki 1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Application Notes" href="../Application-Notes.html" />
    <link rel="next" title="Using GDB Debugger" href="gdb.html" />
    <link rel="prev" title="Linux Configuration" href="linux-configuration.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="gdb.html" title="Using GDB Debugger"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="linux-configuration.html" title="Linux Configuration"
             accesskey="P">previous</a> |</li>
        <!-- <li class="nav-item nav-item-0"><a href="../../../index.html">RDU-Wiki 1.0 documentation</a> &raquo;</li> -->
        <li class="nav-item nav-item-0"><a href="../../../index.html">Main Page</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../Application-Notes.html" accesskey="U">Application Notes</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="build-custom-linux">
<h1>Build Custom Linux<a class="headerlink" href="#build-custom-linux" title="Permalink to this headline">¶</a></h1>
<p>Build customized Linux for Beaglebone Black[1].</p>
<div class="section" id="install-toolchain">
<h2>Install toolchain<a class="headerlink" href="#install-toolchain" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget -c https://releases.linaro.org/components/toolchain/binaries/6.4-2018.05/arm-linux-gnueabihf/gcc-linaro-6.4.1-2018.05-x86_64_arm-linux-gnueabihf.tar.xz
$ tar xf gcc-linaro-6.4.1-2018.05-x86_64_arm-linux-gnueabihf.tar.xz
</pre></div>
</div>
</div>
<div class="section" id="install-dependencies">
<h2>Install dependencies<a class="headerlink" href="#install-dependencies" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt install bison flex lzop u-boot-tools
</pre></div>
</div>
</div>
<div class="section" id="build-bootloader">
<h2>Build bootloader<a class="headerlink" href="#build-bootloader" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/u-boot/u-boot
$ <span class="nb">cd</span> u-boot/
$ git checkout v2018.09 -b tmp

$ wget -c https://rcn-ee.com/repos/git/u-boot-patches/v2018.09/0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
$ wget -c https://rcn-ee.com/repos/git/u-boot-patches/v2018.09/0002-U-Boot-BeagleBone-Cape-Manager.patch

$ patch -p1 &lt; <span class="m">0001</span>-am335x_evm-uEnv.txt-bootz-n-fixes.patch
$ patch -p1 &lt; <span class="m">0002</span>-U-Boot-BeagleBone-Cape-Manager.patch

$ make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- distclean
$ make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- am335x_evm_defconfig
$ make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf-
</pre></div>
</div>
</div>
<div class="section" id="setup-wifi">
<h2>Setup Wifi<a class="headerlink" href="#setup-wifi" title="Permalink to this headline">¶</a></h2>
<p>You can use “connman” to manage the wireless network. But I personally prefer using the old way.</p>
<ul class="simple">
<li>Disable connman</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ systemctl disable connman.service
</pre></div>
</div>
<ul class="simple">
<li>Generate WPA passphrase for your WiFi</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wpa_passphrase &lt;ssid&gt; &lt;password&gt;
</pre></div>
</div>
<ul class="simple">
<li>Update /etc/network/interfaces</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo nano /etc/network/interfaces
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># interfaces(5) file used by ifup(8) and ifdown(8)</span>
auto lo
iface lo inet loopback

auto wlan0
iface wlan0 inet dhcp
    wpa-ssid ExampleWifi
    wpa-psk &lt;wpa-psk-generated-by-wpa-passphrase-command&gt;
</pre></div>
</div>
</div>
<div class="section" id="mount-usr-and-home-on-sd-card">
<h2>Mount “/usr” and “/home” on SD card<a class="headerlink" href="#mount-usr-and-home-on-sd-card" title="Permalink to this headline">¶</a></h2>
<p>The BeagleBone Blue has 4G on-board eMMC flash storage. It could be enough for many applications. But for experimental projects, it’s more convenient to have more space so that you don’t need to worry too much about filling the eMMC flash up when installing new packages.</p>
<p>Check reference [2] to get more detailed instructions. Here is a brief summary of what you need to do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. format your SD card into two partitions</span>
<span class="c1"># 2. insert the SD card and power up the board</span>
<span class="c1"># 3. check if you have the two partitions on the SD card recognized by the OS correctly</span>
$ fdisk -l
<span class="c1"># (the two partitions are labeled as &quot;/dev/mmcblk0p1&quot; and &quot;/dev/mmcblk0p2&quot; on my board)</span>
<span class="c1"># 4. format the two partions as ext4</span>
$ mkfs.ext4 /dev/mmcblk0p1
$ mkfs.ext4 /dev/mmcblk0p2
<span class="c1"># 5. create temporary folders in /tmp and mount the two partitions to the temporary folders, copy files from /usr and /home accordingly</span>
$ sudo mkdir /tmp/usr
$ sudo mkdir /tmp/home
$ sudo mount /dev/mmcblk0p1 /tmp/usr
$ sudo mount /dev/mmcblk0p2 /tmp/home
$ sudo rsync -ahv --progress /usr/ /tmp/usr/
$ sudo rsync -ahv --progress /home/ /tmp/home/
<span class="c1"># 6. update /etc/fstab to reflect the change</span>
$ sudo lsblk -no UUID /dev/mmcblk0p1 <span class="c1"># get UUID of /dev/mmcblk0p1</span>
<span class="c1"># add two lines in /etc/fstab</span>
$ <span class="nv">UUID</span><span class="o">=</span>&lt;ID-YOU-GOT-FROM-ABOVE-CMD&gt; /usr ext4    defaults <span class="m">0</span> <span class="m">1</span>
$ <span class="nv">UUID</span><span class="o">=</span>&lt;ID-YOU-GOT-FROM-ABOVE-CMD&gt; /home ext4    defaults <span class="m">0</span> <span class="m">1</span>
or
$ /dev/mmcblk0p1 /usr ext4 defaults <span class="m">0</span> <span class="m">1</span>
$ /dev/mmcblk0p2 /home ext4 defaults <span class="m">0</span> <span class="m">1</span>
<span class="c1"># 7. reboot and check the files</span>
$ df -h
</pre></div>
</div>
</div>
<div class="section" id="update-kernel">
<h2>Update Kernel<a class="headerlink" href="#update-kernel" title="Permalink to this headline">¶</a></h2>
<p>You can upgrade or change to a Preempt-RT patched kernel using the script provided in the Debian OS from Beaglebone</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /opt/scripts/tools
$ git pull   <span class="c1"># you may need to use sudo here</span>
$ sudo /opt/scripts/tools/update_kernel.sh --bone-rt-channel --lts-4_4   <span class="c1"># --lts-stable or other available options</span>
</pre></div>
</div>
<p>Refer to [5] for additiona options.</p>
<p>Note that if you use the kernel from TI channel (for example, use “–ti-rt-channel” option), you might experience errors related to the PINMUX helper driver.</p>
</div>
<div class="section" id="robotics-cape-library">
<h2>Robotics Cape library<a class="headerlink" href="#robotics-cape-library" title="Permalink to this headline">¶</a></h2>
<p>TI channel kernels have more complete support to PRU drivers so you may want to use a kernel from the TI channel if you’re using the Robotics Cape or Beaglebone Blue.[7]</p>
<p>When using the TI channel RT kernel 4.4 and 4.9 on Beaglebone Blue with the Robotics Cape library, I got the following error message from the library:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>...
can&#39;t open: /sys/devices/platform/ocp/ocp:P9_24_pinmux/state
Pinmux: No such file or directory
WARNING: missing PINMUX driver
You probbaly just need a newer kernel
</pre></div>
</div>
<p>I’m not sure if this will happen to other boards or how to install this pinmux helper driver manually for the TI channel kernels. I resolved this issue by switching to a bone channel kernel.</p>
<p>The other issue related to the Robotics Cape library that occured even after installing the bone channel RT kernel is on the pru-rproc driver, which gives the error message</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ERROR: pru-rproc driver missing
</pre></div>
</div>
<p>The solution is to add a symbolic link of clpru executable to /usr/share/ti/cgt-pru/bin folder:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /usr/share/ti/cgt-pru
mkdir bin
<span class="nb">cd</span> bin
ln -s /usr/bin/clpru clpru
</pre></div>
</div>
<p>See [6] for more discussions on this issue and the above solution is from this page.</p>
</div>
<div class="section" id="buid-u-boot">
<h2>Buid u-boot<a class="headerlink" href="#buid-u-boot" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="buid-kernel">
<h2>Buid Kernel<a class="headerlink" href="#buid-kernel" title="Permalink to this headline">¶</a></h2>
<p>Reference</p>
<ul class="simple">
<li>[1] <a class="reference external" href="https://www.digikey.com/eewiki/display/linuxonarm/BeagleBone+Black">https://www.digikey.com/eewiki/display/linuxonarm/BeagleBone+Black</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Build Custom Linux</a><ul>
<li><a class="reference internal" href="#install-toolchain">Install toolchain</a></li>
<li><a class="reference internal" href="#install-dependencies">Install dependencies</a></li>
<li><a class="reference internal" href="#build-bootloader">Build bootloader</a></li>
<li><a class="reference internal" href="#setup-wifi">Setup Wifi</a></li>
<li><a class="reference internal" href="#mount-usr-and-home-on-sd-card">Mount “/usr” and “/home” on SD card</a></li>
<li><a class="reference internal" href="#update-kernel">Update Kernel</a></li>
<li><a class="reference internal" href="#robotics-cape-library">Robotics Cape library</a></li>
<li><a class="reference internal" href="#buid-u-boot">Buid u-boot</a></li>
<li><a class="reference internal" href="#buid-kernel">Buid Kernel</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="linux-configuration.html"
                        title="previous chapter">Linux Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="gdb.html"
                        title="next chapter">Using GDB Debugger</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="gdb.html" title="Using GDB Debugger"
             >next</a> |</li>
        <li class="right" >
          <a href="linux-configuration.html" title="Linux Configuration"
             >previous</a> |</li>
        <!-- <li class="nav-item nav-item-0"><a href="../../../index.html">RDU-Wiki 1.0 documentation</a> &raquo;</li> -->
        <li class="nav-item nav-item-0"><a href="../../../index.html">Main Page</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../Application-Notes.html" >Application Notes</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, Ruixiang Du.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.7.
    </div>
  </body>
</html>